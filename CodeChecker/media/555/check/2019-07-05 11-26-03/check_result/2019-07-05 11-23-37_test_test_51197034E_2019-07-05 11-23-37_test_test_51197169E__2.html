<span style="background-color: red">#include&lt;bits/stdc++.h&gt;</span></br>
<span style="background-color: red">usingnamespacestd;</span></br>
<span style="background-color: greenyellow">typedeflonglongintll;</span></br>
<span style="background-color: greenyellow">constintn=300300;</span></br>
<span style="background-color: yellow">intn,q;</span></br>
<span style="background-color: white">lltree[4*n],mn[4*n],lazy[4*n];</span></br>
<span style="background-color: white">lla[n],k[n];</span></br>
<span style="background-color: white">voidbuild(intx,intl,intr){</span></br>
<span style="background-color: red">if(l==r){</span></br>
<span style="background-color: white">tree[x]=a[l];</span></br>
<span style="background-color: white">mn[x]=a[l];</span></br>
<span style="background-color: yellow">}else{</span></br>
<span style="background-color: white">intmid=(l+r)&gt;&gt;1;</span></br>
<span style="background-color: white">build(x+x,l,mid);</span></br>
<span style="background-color: white">build(x+x+1,mid+1,r);</span></br>
<span style="background-color: white">tree[x]=tree[x+x]+tree[x+x+1];</span></br>
<span style="background-color: white">mn[x]=max(mn[x+x],mn[x+x+1]);</span></br>
<span style="background-color: write">}</span>
<span style="background-color: write">}</span>
<span style="background-color: white">voidpropagate(intx,intl,intr){</span></br>
<span style="background-color: white">if(lazy[x]==0){</span></br>
<span style="background-color: red">return;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">tree[x]=1ll*(r-l+1)*lazy[x];</span></br>
<span style="background-color: white">mn[x]=lazy[x];</span></br>
<span style="background-color: red">if(l!=r){</span></br>
<span style="background-color: greenyellow">lazy[x+x]=lazy[x];</span></br>
<span style="background-color: white">lazy[x+x+1]=lazy[x];</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">lazy[x]=0;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: greenyellow">voidup(intx,intl,intr,inta,intb,llval){</span></br>
<span style="background-color: greenyellow">propagate(x,l,r);</span></br>
<span style="background-color: greenyellow">if(l&gt;b||r&lt;a){</span></br>
<span style="background-color: greenyellow">return;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: greenyellow">if(l&gt;=a&&r&lt;=b){</span></br>
<span style="background-color: white">lazy[x]=val;</span></br>
<span style="background-color: greenyellow">propagate(x,l,r);</span></br>
<span style="background-color: greenyellow">return;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">intmid=(l+r)&gt;&gt;1;</span></br>
<span style="background-color: white">up(x+x,l,mid,a,b,val);</span></br>
<span style="background-color: white">up(x+x+1,mid+1,r,a,b,val);</span></br>
<span style="background-color: white">tree[x]=tree[x+x]+tree[x+x+1];</span></br>
<span style="background-color: white">mn[x]=max(mn[x+x],mn[x+x+1]);</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">intget_id(intx,intl,intr,inta,llval){</span></br>
<span style="background-color: white">propagate(x,l,r);</span></br>
<span style="background-color: white">if(r&lt;a||mn[x]&lt;=val){</span></br>
<span style="background-color: greenyellow">return-1;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">if(l==r){</span></br>
<span style="background-color: white">returnl;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">intmid=(l+r)&gt;&gt;1;</span></br>
<span style="background-color: white">inty=get_id(x+x,l,mid,a,val);</span></br>
<span style="background-color: white">if(y==-1){</span></br>
<span style="background-color: white">y=get_id(x+x+1,mid+1,r,a,val);</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">returny;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">llget_sum(intx,intl,intr,inta,intb){</span></br>
<span style="background-color: white">propagate(x,l,r);</span></br>
<span style="background-color: greenyellow">if(r&lt;a||l&gt;b){</span></br>
<span style="background-color: red">return0;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">if(l&gt;=a&&r&lt;=b){</span></br>
<span style="background-color: white">returntree[x];</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">intmid=(l+r)&gt;&gt;1;</span></br>
<span style="background-color: white">returnget_sum(x+x,l,mid,a,b)+get_sum(x+x+1,mid+1,r,a,b);</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">llmagic(intl,intr){</span></br>
<span style="background-color: white">llans=k[r-1];</span></br>
<span style="background-color: white">if(l&gt;1){</span></br>
<span style="background-color: white">ans-=k[l-2];</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">returnans;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: yellow">intmain(){</span></br>
<span style="background-color: white">ios::sync_with_stdio(false);</span></br>
<span style="background-color: white">cin.tie(nullptr);</span></br>
<span style="background-color: greenyellow">cin&gt;&gt;n;</span></br>
<span style="background-color: greenyellow">for(inti=1;i&lt;=n;i++){</span></br>
<span style="background-color: yellow">cin&gt;&gt;a[i];</span></br>
<span style="background-color: write">}</span>
<span style="background-color: red">for(inti=1;i&lt;=n-1;i++){</span></br>
<span style="background-color: yellow">cin&gt;&gt;k[i];</span></br>
<span style="background-color: white">k[i]+=k[i-1];</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">for(inti=1;i&lt;=n;i++){</span></br>
<span style="background-color: white">a[i]-=k[i-1];</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">for(inti=1;i&lt;=n-1;i++){</span></br>
<span style="background-color: white">k[i]+=k[i-1];</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">for(inti=1;i&lt;=n-1;i++){</span></br>
<span style="background-color: white">while(!(a[i]&lt;=a[i+1]));</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">build(1,1,n);</span></br>
<span style="background-color: greenyellow">/*cout&lt;&lt;"vamo:\n";</span></br>
<span style="background-color: white">for(inti=1;i&lt;=n;i++){</span></br>
<span style="background-color: white">cout&lt;&lt;i&lt;&lt;"="&lt;&lt;get_sum(1,1,n,i,i)+magic(i,i)&lt;&lt;endl;</span></br>
<span style="background-color: greenyellow">}*/</span></br>
<span style="background-color: greenyellow">cin&gt;&gt;q;</span></br>
<span style="background-color: white">while(q--){</span></br>
<span style="background-color: white">charc;</span></br>
<span style="background-color: yellow">intl,r;</span></br>
<span style="background-color: white">cin&gt;&gt;c&gt;&gt;l&gt;&gt;r;</span></br>
<span style="background-color: greenyellow">if(c=='+'){</span></br>
<span style="background-color: white">if(r==0)continue;</span></br>
<span style="background-color: white">llcur=get_sum(1,1,n,l,l);</span></br>
<span style="background-color: white">intpos=-1,l=l,r=r;</span></br>
<span style="background-color: white">while(l&lt;=r){</span></br>
<span style="background-color: white">intmid=(l+r)&gt;&gt;1;</span></br>
<span style="background-color: white">if(get_sum(1,1,n,mid,mid)&gt;=cur+r){</span></br>
<span style="background-color: white">pos=mid;</span></br>
<span style="background-color: greenyellow">r=mid-1;</span></br>
<span style="background-color: yellow">}else{</span></br>
<span style="background-color: white">l=mid+1;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: write">}</span>
<span style="background-color: white">if(pos==-1){</span></br>
<span style="background-color: white">pos=n+1;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">up(1,1,n,l,pos-1,cur+r);</span></br>
<span style="background-color: red">}else{</span></br>
<span style="background-color: white">cout&lt;&lt;get_sum(1,1,n,l,r)+magic(l,r)&lt;&lt;endl;</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">/*cout&lt;&lt;"vamo:\n";</span></br>
<span style="background-color: white">for(inti=1;i&lt;=n;i++){</span></br>
<span style="background-color: white">cout&lt;&lt;i&lt;&lt;"="&lt;&lt;get_sum(1,1,n,i,i)+magic(i,i)&lt;&lt;endl;</span></br>
<span style="background-color: greenyellow">}*/</span></br>
<span style="background-color: write">}</span>
<span style="background-color: white">return0;</span></br>
<span style="background-color: write">}</span>
